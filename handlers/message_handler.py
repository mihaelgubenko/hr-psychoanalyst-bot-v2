"""
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π –±–æ—Ç–∞
"""

import logging
from typing import Dict, Any, Optional
from telegram import Update
from telegram.ext import ContextTypes
from telegram.constants import ParseMode

logger = logging.getLogger(__name__)

class MessageHandler:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π"""
    
    def __init__(self, ai_client, database):
        self.ai_client = ai_client
        self.database = database
    
    async def start(self, update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start —Å –≥–ª–∞–≤–Ω—ã–º –º–µ–Ω—é"""
        from telegram import InlineKeyboardButton, InlineKeyboardMarkup
        
        user = update.effective_user
        
        # –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        self.ai_client.clear_user_data(user.id)
        
        welcome_text = f"""
üìñ **–ö–ù–ò–ì–ê "–í–û–°–•–û–ñ–î–ï–ù–ò–ï"**

–®–∞–ª–æ–º, {user.first_name or '–¥—Ä—É–≥'}! 

–Ø –ø–æ–º–æ–≥—É –≤–∞–º –ø—Ä–æ–π—Ç–∏ –ø—É—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ –∫–Ω–∏–≥–µ "–í–æ—Å—Ö–æ–∂–¥–µ–Ω–∏–µ".

**–ü—Ä–∏–Ω—Ü–∏–ø—ã –∫–Ω–∏–≥–∏:**
‚Ä¢ "–î–ª—è –º–µ–Ω—è —Å–æ–∑–¥–∞–Ω –º–∏—Ä" - –≤—ã –≤–∞–∂–Ω—ã –∫–∞–∫ —Ü–µ–ª—ã–π –º–∏—Ä
‚Ä¢ –ö–∞–∂–¥—ã–π —Å–æ–∑–¥–∞–Ω –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–π –º–∏—Å—Å–∏–∏
‚Ä¢ –£ –≤–∞—Å –µ—Å—Ç—å –≤—Å–µ —Å–∏–ª—ã –¥–ª—è –µ—ë –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

üí° *–í—ã–±–µ—Ä–∏—Ç–µ, —á—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç:*
"""
        
        # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏
        keyboard = [
            [InlineKeyboardButton("üìä –¢–µ—Å—Ç —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∏", callback_data='test_samoocenka')],
            [InlineKeyboardButton("üí¨ –°–≤–æ–±–æ–¥–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è", callback_data='consultation')],
            [InlineKeyboardButton("üìö –û –∫–Ω–∏–≥–µ", callback_data='about_book')],
            [
                InlineKeyboardButton("‚≠ê –ü—Ä–µ–º–∏—É–º", callback_data='premium'),
                InlineKeyboardButton("üë§ –õ–∏—á–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è", callback_data='personal')
            ],
            [InlineKeyboardButton("‚ùì –°–ø—Ä–∞–≤–∫–∞", callback_data='help')]
        ]
        
        reply_markup = InlineKeyboardMarkup(keyboard)
        
        await update.message.reply_text(
            welcome_text, 
            reply_markup=reply_markup,
            parse_mode=ParseMode.MARKDOWN
        )
        return 'WAITING_MESSAGE'
    
    async def help_command(self, update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help"""
        help_text = (
            "*–°–ü–†–ê–í–ö–ê*\n\n"
            "*–ë–µ—Å–ø–ª–∞—Ç–Ω–æ:*\n"
            "‚Ä¢ –î–∏–∞–ª–æ–≥ –∏ —ç–∫—Å–ø—Ä–µ—Å—Å-–∞–Ω–∞–ª–∏–∑\n"
            "‚Ä¢ –¢–µ—Å—Ç —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∏ (30 –≤–æ–ø—Ä–æ—Å–æ–≤)\n"
            "‚Ä¢ –ü–æ–¥–±–æ—Ä –∫–∞—Ä—å–µ—Ä—ã\n\n"
            "*–ü–ª–∞—Ç–Ω–æ (500‚ÇΩ):*\n"
            "‚Ä¢ –ü–æ–ª–Ω—ã–π –ø—Å–∏—Ö–æ–∞–Ω–∞–ª–∏–∑\n"
            "‚Ä¢ –õ–∏—á–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è\n\n"
            "*–ö–æ–º–∞–Ω–¥—ã:*\n"
            "/start \\- –º–µ–Ω—é\n"
            "/self\\_esteem \\- —Ç–µ—Å—Ç\n"
            "/consultation \\- –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è\n"
            "/cancel \\- –æ—Ç–º–µ–Ω–∏—Ç—å\n\n"
            "–ü—Ä–æ—Å—Ç–æ –ø–∏—à–∏—Ç–µ –æ —Ç–æ–º, —á—Ç–æ –±–µ—Å–ø–æ–∫–æ–∏—Ç!"
        )
        await update.message.reply_text(help_text, parse_mode=ParseMode.MARKDOWN)
    
    async def cancel(self, update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /cancel"""
        user = update.effective_user
        
        # –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        self.ai_client.clear_user_data(user.id)
        
        await update.message.reply_text(
            "–ê–Ω–∞–ª–∏–∑ –æ—Ç–º–µ–Ω–µ–Ω. –î–ª—è –Ω–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start"
        )
        return 'END'
    
    async def reset_bot(self, update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /reset"""
        user = update.effective_user
        
        # –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        self.ai_client.clear_user_data(user.id)
        
        await update.message.reply_text(
            "üîÑ –ë–æ—Ç —Å–±—Ä–æ—à–µ–Ω!\n\n"
            "–í—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã. –ù–∞—á–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ —Å /start"
        )
    
    async def clear_memory(self, update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
        """–û—á–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏ –±–æ—Ç–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)"""
        user = update.effective_user
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∞–¥–º–∏–Ω–∞ (–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å)
        if user.id != 123456789:  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à Telegram ID
            await update.message.reply_text("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")
            return
        
        # –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
        self.ai_client.response_cache.clear()
        
        # –û—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        try:
            await self.database.clear_all_data()
            
            await update.message.reply_text(
                "‚úÖ –ü–∞–º—è—Ç—å –±–æ—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω–∞:\n"
                "‚Ä¢ –û—á–∏—â–µ–Ω–∞ RAM –ø–∞–º—è—Ç—å\n"
                "‚Ä¢ –û—á–∏—â–µ–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö\n"
                "‚Ä¢ –í—Å–µ –¥–∏–∞–ª–æ–≥–∏ —É–¥–∞–ª–µ–Ω—ã\n\n"
                "üí° –î–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞ Telegram –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –∫–æ–º–∞–Ω–¥–æ–π /start"
            )
        except Exception as e:
            await update.message.reply_text(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ: {e}")
    
    async def consultation_info(self, update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
        """–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–∏—á–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏"""
        consultation_text = """
üí´ **–õ–ò–ß–ù–ê–Ø –ö–û–ù–°–£–õ–¨–¢–ê–¶–ò–Ø**

–Ø –ø–æ–º–æ–≥—É –≤–∞–º –ø—Ä–æ–π—Ç–∏ –ø—É—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ —Ä–∞—Å–∫—Ä—ã—Ç—å –≤–∞—à –∏—Å—Ç–∏–Ω–Ω—ã–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª.

**–ß—Ç–æ —è –ø—Ä–µ–¥–ª–∞–≥–∞—é:**

‚ú® **–ü–æ–≤—ã—à–µ–Ω–∏–µ —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∏**
‚Ä¢ –ò–∑–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç —Å–∞–º–æ–∫—Ä–∏—Ç–∏–∫–∏ –∏ —Å–æ–º–Ω–µ–Ω–∏–π
‚Ä¢ –û–±—Ä–µ—Ç–µ–Ω–∏–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —Å–µ–±–µ
‚Ä¢ –ü—Ä–∏–Ω—è—Ç–∏–µ –∏ –ª—é–±–æ–≤—å –∫ —Å–µ–±–µ

üéØ **–ü–æ–∏—Å–∫ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è**
‚Ä¢ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –¥–∞—Ä–∞
‚Ä¢ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω–æ–π –º–∏—Å—Å–∏–∏
‚Ä¢ –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–∞—Ä—å–µ—Ä—ã –ø–æ –ø—Ä–∏–∑–≤–∞–Ω–∏—é

üòå **–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –æ—Ç –Ω–µ–≥–∞—Ç–∏–≤–∞**
‚Ä¢ –ü—Ä–æ—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–∞—Ö–æ–≤ –∏ —Ç—Ä–µ–≤–æ–≥
‚Ä¢ –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –≥–Ω–µ–≤–∞ –≤ —Å–∏–ª—É
‚Ä¢ –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –æ—Ç –æ–±–∏–¥ –ø—Ä–æ—à–ª–æ–≥–æ

üíù **–ì–∞—Ä–º–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π**
‚Ä¢ –£–ª—É—á—à–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å –±–ª–∏–∑–∫–∏–º–∏
‚Ä¢ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—ã—Ö –≥—Ä–∞–Ω–∏—Ü
‚Ä¢ –ü—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

**–§–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã:**
‚Ä¢ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Å–µ—Å—Å–∏–∏ 1-2 —á–∞—Å–∞
‚Ä¢ –û–Ω–ª–∞–π–Ω/–æ—Ñ—Ñ–ª–∞–π–Ω (–Ω–∞ –≤–∞—à –≤—ã–±–æ—Ä)
‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∞–∑–≤–∏—Ç–∏—è
‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏

**–°—Ç–æ–∏–º–æ—Å—Ç—å:** –æ–±—Å—É–∂–¥–∞–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ

üìû **–ó–∞–ø–∏—Å–∞—Ç—å—Å—è:**
–ù–∞–ø–∏—à–∏—Ç–µ –º–Ω–µ: [–í–∞—à Telegram/Email/–¢–µ–ª–µ—Ñ–æ–Ω]

–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ "–•–æ—á—É –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é" –∑–¥–µ—Å—å!

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üíô –í–∞—à–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –ø–µ—Ä–≤–æ–≥–æ —à–∞–≥–∞!
"""
        
        await update.message.reply_text(consultation_text, parse_mode=ParseMode.MARKDOWN)
    
    async def get_stats(self, update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)"""
        user = update.effective_user
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∞–¥–º–∏–Ω–∞
        if user.id != 123456789:  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à Telegram ID
            await update.message.reply_text("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")
            return
        
        try:
            # –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–∏—Å—Ç–µ–º—ã
            system_health = self.ai_client.get_system_health()
            
            stats_text = f"""
üìä **–°–¢–ê–¢–ò–°–¢–ò–ö–ê –°–ò–°–¢–ï–ú–´**

**–¢–æ–∫–µ–Ω—ã:**
‚Ä¢ –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤: {system_health['token_monitor']['total_requests']}
‚Ä¢ –í—Å–µ–≥–æ —Ç–æ–∫–µ–Ω–æ–≤: {system_health['token_monitor']['total_tokens']}
‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ –Ω–∞ –∑–∞–ø—Ä–æ—Å: {system_health['token_monitor']['avg_tokens_per_request']:.1f}
‚Ä¢ –ü—Ä–æ—Ü–µ–Ω—Ç –æ–±—Ä–µ–∑–∞–Ω–Ω—ã—Ö: {system_health['token_monitor']['truncation_rate']:.1%}

**–ö—ç—à:**
‚Ä¢ –ó–∞–ø–∏—Å–µ–π –≤ –∫—ç—à–µ: {system_health['response_cache']['total_entries']}
‚Ä¢ –ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π: {system_health['response_cache']['hit_rate']:.1%}
‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: {system_health['response_cache']['memory_usage_estimate']} –±–∞–π—Ç

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:**
‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö: {system_health['token_monitor']['active_users']}

**–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:**
{chr(10).join(system_health['token_monitor']['optimization_alerts']) if system_health['token_monitor']['optimization_alerts'] else '–ù–µ—Ç'}
"""
            
            await update.message.reply_text(stats_text, parse_mode=ParseMode.MARKDOWN)
            
        except Exception as e:
            await update.message.reply_text(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: {e}")
    
    async def optimize_user(self, update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
        """–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        user = update.effective_user
        
        try:
            # –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç—É—Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
            optimization_status = self.ai_client.get_user_optimization_status(user.id)
            
            # –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é
            optimization_result = self.ai_client.optimize_user_experience(user.id)
            
            result_text = f"""
üîß **–û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê**

**–ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
{chr(10).join([opt['description'] for opt in optimization_result.get('applied_optimizations', [])]) if optimization_result.get('applied_optimizations') else '–ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π'}

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
{chr(10).join([rec.description for rec in optimization_status['optimization_suggestions']]) if optimization_status['optimization_suggestions'] else '–ù–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π'}

**–°—Ç–∞—Ç—É—Å –∫—ç—à–∞:**
‚Ä¢ –ó–∞–ø–∏—Å–µ–π: {optimization_status['cache_stats']['total_entries']}
‚Ä¢ –ü–æ–ø–∞–¥–∞–Ω–∏–π: {optimization_status['cache_stats']['hit_rate']:.1%}
"""
            
            await update.message.reply_text(result_text, parse_mode=ParseMode.MARKDOWN)
            
        except Exception as e:
            await update.message.reply_text(f"‚ùå –û—à–∏–±–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏: {e}")
    
    async def handle_button_click(self, update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏ InlineKeyboard"""
        from telegram import InlineKeyboardButton, InlineKeyboardMarkup
        
        query = update.callback_query
        await query.answer()
        
        data = query.data
        
        if data == 'test_samoocenka':
            # –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Ç–µ—Å—Ç —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∏
            await query.edit_message_text(
                "üìä **–¢–ï–°–¢ –°–ê–ú–û–û–¶–ï–ù–ö–ò**\n\n"
                "–û—Ç–ª–∏—á–Ω–æ! –°–µ–π—á–∞—Å –∑–∞–ø—É—Å—Ç–∏–º —Ç–µ—Å—Ç.\n"
                "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É: /self\\_esteem",
                parse_mode=ParseMode.MARKDOWN
            )
            
        elif data == 'consultation':
            # –°–≤–æ–±–æ–¥–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è
            await query.edit_message_text(
                "üí¨ **–°–í–û–ë–û–î–ù–ê–Ø –ö–û–ù–°–£–õ–¨–¢–ê–¶–ò–Ø**\n\n"
                "–û—Ç–ª–∏—á–Ω–æ! –ù–∞–ø–∏—à–∏—Ç–µ, —á—Ç–æ –≤–∞—Å –±–µ—Å–ø–æ–∫–æ–∏—Ç, –∏ —è –ø–æ–º–æ–≥—É –Ω–∞ –æ—Å–Ω–æ–≤–µ:\n\n"
                "‚Ä¢ –ü—Ä–∏–Ω—Ü–∏–ø–æ–≤ –∫–Ω–∏–≥–∏ \"–í–æ—Å—Ö–æ–∂–¥–µ–Ω–∏–µ\"\n"
                "‚Ä¢ –°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏\n"
                "‚Ä¢ –≠–º–ø–∞—Ç–∏–∏ –∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è\n\n"
                "üí° *–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å*",
                parse_mode=ParseMode.MARKDOWN
            )
            
        elif data == 'about_book':
            # –û –∫–Ω–∏–≥–µ
            about_text = """
üìö **–û –ö–ù–ò–ì–ï "–í–û–°–•–û–ñ–î–ï–ù–ò–ï"**

"–í–æ—Å—Ö–æ–∂–¥–µ–Ω–∏–µ" - –∞–≤—Ç–æ—Ä—Å–∫–∞—è –∫–Ω–∏–≥–∞ –æ –¥—É—Ö–æ–≤–Ω–æ–º —Ä–æ—Å—Ç–µ –∏ —Å–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏–∏.

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã:**
‚Ä¢ –°–∞–º–æ–æ—Ü–µ–Ω–∫–∞ –∏ —Å–∞–º–æ—É–≤–∞–∂–µ–Ω–∏–µ
‚Ä¢ –†–∞–±–æ—Ç–∞ —Å —ç–º–æ—Ü–∏—è–º–∏ (—Å—Ç—Ä–∞—Ö–∏, –≥–Ω–µ–≤, –æ–±–∏–¥—ã)
‚Ä¢ –ü–æ–∏—Å–∫ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
‚Ä¢ –î—É—Ö–æ–≤–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ
‚Ä¢ –ü—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
1. "–î–ª—è –º–µ–Ω—è —Å–æ–∑–¥–∞–Ω –º–∏—Ä" - –∫–∞–∂–¥—ã–π –≤–∞–∂–µ–Ω
2. –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–∏–ª—ã - –∫–æ—Ä–µ–Ω—å –≤–Ω–µ—à–Ω–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π
3. –°–∞–º–æ—É–≤–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –æ—Å–æ–∑–Ω–∞–Ω–∏–µ —Å–≤–æ–µ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏
4. –ö–∞–∂–¥—ã–π —Å–æ–∑–¥–∞–Ω –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–π –º–∏—Å—Å–∏–∏

**–ú–µ—Ç–æ–¥—ã –∏–∑ –∫–Ω–∏–≥–∏:**
‚Ä¢ –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –¥–ª—è —É–∫–æ—Ä–µ–Ω–µ–Ω–∏—è –≤ –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–∏
‚Ä¢ –î–∏–∞–ª–æ–≥ —Å –¥—É—à–æ–π
‚Ä¢ –°–∞–º–æ–∞–Ω–∞–ª–∏–∑
‚Ä¢ –†–∞–±–æ—Ç–∞ —Å –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
‚Ä¢ –í—ã—Ä–∞–∂–µ–Ω–∏–µ —ç–º–æ—Ü–∏–π

/start - –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é
"""
            await query.edit_message_text(about_text, parse_mode=ParseMode.MARKDOWN)
            
        elif data == 'premium':
            # –ü—Ä–µ–º–∏—É–º –¥–æ—Å—Ç—É–ø (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
            premium_text = """
‚≠ê **–ü–†–ï–ú–ò–£–ú –î–û–°–¢–£–ü**
*(–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)*

**–ß—Ç–æ –±—É–¥–µ—Ç –≤–∫–ª—é—á–µ–Ω–æ:**
‚ú® –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∏ (30 –≤–æ–ø—Ä–æ—Å–æ–≤)
‚ú® –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
‚ú® –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è
‚ú® –î–Ω–µ–≤–Ω–∏–∫ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
‚ú® –í—Å–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –∏–∑ –∫–Ω–∏–≥–∏
‚ú® –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ PDF

**–¶–µ–Ω–∞:** 500‚ÇΩ/–º–µ—Å—è—Ü

üîî *–£–≤–µ–¥–æ–º–∏–º –≤–∞—Å –æ –∑–∞–ø—É—Å–∫–µ!*

/start - –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é
"""
            await query.edit_message_text(premium_text, parse_mode=ParseMode.MARKDOWN)
            
        elif data == 'personal':
            # –õ–∏—á–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è
            personal_text = """
üë§ **–õ–ò–ß–ù–ê–Ø –ö–û–ù–°–£–õ–¨–¢–ê–¶–ò–Ø**

–ü–æ–ª—É—á–∏—Ç–µ –≥–ª—É–±–æ–∫—É—é –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É —Å –∞–≤—Ç–æ—Ä–æ–º –∫–Ω–∏–≥–∏ "–í–æ—Å—Ö–æ–∂–¥–µ–Ω–∏–µ"

üìã **–ß–¢–û –í–ö–õ–Æ–ß–ï–ù–û:**
‚Ä¢ –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤–∞—à–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏
‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
‚Ä¢ –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –ø–æ–¥ –≤–∞—à —Å–ª—É—á–∞–π
‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∞ –≤—Å—ë–º –ø—É—Ç–∏

üí∞ **–í–∞—Ä–∏–∞–Ω—Ç—ã:**
1. –≠–∫—Å–ø—Ä–µ—Å—Å - 2000‚ÇΩ (30 –º–∏–Ω)
2. –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è - 5000‚ÇΩ (1.5 —á–∞—Å–∞)
3. –ú–µ—Å—è—á–Ω–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ - 20000‚ÇΩ

üìù *–î–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞–ø–∏—à–∏—Ç–µ: "–•–æ—á—É –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é"*

/start - –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é
"""
            await query.edit_message_text(personal_text, parse_mode=ParseMode.MARKDOWN)
            
        elif data == 'help':
            # –°–ø—Ä–∞–≤–∫–∞
            help_text = """
‚ùì **–°–ü–†–ê–í–ö–ê**

**üéØ –° –ß–ï–ì–û –ù–ê–ß–ê–¢–¨:**

1Ô∏è‚É£ –ü—Ä–æ–π–¥–∏—Ç–µ /self\\_esteem
   ‚Üí –£–∑–Ω–∞–µ—Ç–µ —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∏

2Ô∏è‚É£ –ù–∞–ø–∏—à–∏—Ç–µ, —á—Ç–æ –±–µ—Å–ø–æ–∫–æ–∏—Ç
   ‚Üí –ü–æ–ª—É—á–∏—Ç–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é

**üí¨ –ö–û–ú–ê–ù–î–´:**
/start - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
/self\\_esteem - –¢–µ—Å—Ç —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∏
/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞

**üìö –ü–†–ò–ù–¶–ò–ü–´ –ö–ù–ò–ì–ò:**
‚Ä¢ "–î–ª—è –º–µ–Ω—è —Å–æ–∑–¥–∞–Ω –º–∏—Ä"
‚Ä¢ –£ –≤–∞—Å –µ—Å—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–∞—è –º–∏—Å—Å–∏—è
‚Ä¢ –£ –≤–∞—Å –µ—Å—Ç—å —Å–∏–ª—ã –¥–ª—è –µ—ë –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

/start - –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é
"""
            await query.edit_message_text(help_text, parse_mode=ParseMode.MARKDOWN)